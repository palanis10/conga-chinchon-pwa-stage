<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Conga by Alanis — STAGE v3.5.9</title>

  <!-- Prevent accidental zooming on mobile -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>

  <meta name="theme-color" content="#0b1222" />

  <style>
    :root{
      --bg:#0b1222;
      --grad1:#0f1a2e;
      --grad2:#0b1222;
      --panel:#121c30;
      --panel2:#101a2b;
      --chip:#1b2944;
      --chip-border:#3a4d71;
      --text:#e7eefc;
      --sub:#aeb9cd;
      --brand1:#8aa8ff;
      --brand2:#c49bff;
      --ok:#64efb2;
      --warn:#ff8c8c;
      --ring:#2bd8a8;
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 800px at 20% -10%, var(--grad1) 60%, var(--grad2));
    }
    .container{max-width:980px;margin:0 auto;padding:20px 16px 64px}

    /* ===== Header (v3.5.5 look) ===== */
    .header{
      display:grid;
      grid-template-columns:minmax(0,1fr) auto auto;
      align-items:center;
      gap:12px;
      margin-top:4px;
    }
    .title-wrap{min-width:0}
    .title{
      font-weight:900;
      font-size:clamp(22px,6vw,32px);
      line-height:1.1;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .stage{
      margin-top:6px;
      font-weight:800;
      color:var(--sub);
      letter-spacing:.5px;
      font-size:clamp(12px,3.4vw,14px);
    }
    .lang{
      display:flex;align-items:center;gap:10px;
      background:rgba(255,255,255,.06);
      border:1px dashed rgba(255,255,255,.15);
      padding:10px 14px;border-radius:999px;
      backdrop-filter: blur(4px);
    }
    .lang button{
      border:0;background:transparent;color:var(--sub);
      font-weight:900;letter-spacing:.5px;
      padding:8px 12px;border-radius:10px;cursor:pointer
    }
    .lang button.active{background:#1e2a44;color:var(--text)}
    .icon-btn{
      width:44px;height:44px;border-radius:12px;display:grid;place-items:center;
      background:rgba(255,255,255,.07);border:1px dashed rgba(255,255,255,.15);cursor:pointer
    }

    /* ===== Controls row ===== */
    .controls{
      margin-top:16px;
      background:linear-gradient(180deg, var(--panel), var(--panel2));
      border-radius:20px;padding:16px;box-shadow:var(--shadow)
    }
    .chip-row{
      display:flex;gap:12px;align-items:center;flex-wrap:nowrap;
    }
    .chip{
      display:flex;align-items:center;gap:10px;
      padding:12px 14px;border-radius:16px;
      background:rgba(255,255,255,.06);
      border:2px dashed rgba(255,255,255,.18);
      color:var(--text);font-weight:900;white-space:nowrap;min-width:0;
      flex:1 1 0;justify-content:center;font-size:clamp(14px,3.8vw,18px)
    }
    .chip .lock{
      width:18px;height:18px;border-radius:4px;
      background: linear-gradient(#f9e48a, #caa12e);
      display:inline-block;position:relative;flex:0 0 auto
    }
    .chip .lock:before{
      content:"";position:absolute;left:50%;top:-6px;transform:translateX(-50%);
      width:12px;height:8px;border:3px solid #caa12e;border-bottom:0;border-radius:10px
    }
    .chip.solid{
      background:linear-gradient(135deg, #8aa8ff, #c49bff);
      border:0;color:#0b1222;box-shadow:0 8px 18px rgba(69,105,255,.35);
      font-weight:1000;
    }

    .section-title{margin:18px 6px 10px;color:var(--sub);font-weight:800}

    /* ===== Players ===== */
    .players{display:flex;flex-direction:column;gap:14px}
    .row{
      background:linear-gradient(180deg, #0f1a2a, #0d1728);
      border-radius:20px;padding:16px;
      outline:2px solid rgba(255,255,255,.06);
      box-shadow:var(--shadow)
    }
    .row.active{outline-color:rgba(47,255,205,.45)}
    .row.drag-hint{outline-color:#8aa8ff}
    .row-body{display:grid;grid-template-columns:28px 72px 1fr auto;align-items:center;gap:14px}
    .handle{font-size:20px;color:var(--sub);opacity:.9;cursor:grab}
    .badge{
      width:60px;height:60px;border-radius:50%;display:grid;place-items:center;
      color:var(--text);font-weight:1000;background:#15223b;position:relative;user-select:none
    }
    .badge:before{
      content:"";position:absolute;inset:-6px;border-radius:50%;
      border:6px solid var(--ring);opacity:.9
    }
    .pname{font-size:clamp(16px,5.2vw,28px);font-weight:1000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .score{font-size:clamp(16px,5.2vw,28px);font-weight:1000;opacity:.95;text-align:right;min-width:2ch}

    .add-player{
      border:2px dashed rgba(255,255,255,.25);
      border-radius:18px;padding:18px;text-align:center;color:var(--text);
      font-weight:900;background:transparent;cursor:pointer
    }

    /* ===== Modal ===== */
    dialog{border:0;background:transparent}
    .modal{
      background:linear-gradient(180deg, var(--panel), var(--panel2));
      border-radius:18px;padding:18px;min-width:min(560px,94vw);color:var(--text);
      box-shadow:var(--shadow);max-height:80vh;overflow:auto
    }
    .modal .hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    .btn{border:0;border-radius:12px;padding:12px 16px;font-weight:900;cursor:pointer}
    .btn.ghost{background:rgba(255,255,255,.08);color:var(--text)}
    .btn.primary{background:var(--ok);color:#0b1222}
    .grid{display:grid;gap:10px}
    .rowInput{
      display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;
      background:rgba(255,255,255,.04);border:1px dashed rgba(255,255,255,.15);
      border-radius:12px;padding:10px
    }
    .rowInput .nm{font-weight:900}
    .rowInput input[type="number"]{
      width:120px;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.18);
      background:#0f1a2a;color:var(--text);font-weight:800
    }
    .minus10{
      display:flex;align-items:center;gap:8px;border-radius:10px;padding:8px 10px;
      background:#16243f;border:1px dashed rgba(255,255,255,.18);cursor:pointer
    }
    .footerRow{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}

    /* Make sure the three chips stay on the same row even in ES */
    @media (max-width:420px){
      .chip{padding:12px 10px;font-size:14px}
      .rowInput input[type="number"]{width:100px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header" id="hdr">
      <div class="title-wrap">
        <div class="title" id="appTitle">Conga by Alanis</div>
        <div class="stage" id="appStage">STAGE v3.5.9</div>
      </div>

      <div class="lang" id="langWrap" role="group" aria-label="Language">
        <button id="langEN" class="active" type="button">EN</button>
        <span style="opacity:.4">|</span>
        <button id="langES" type="button">ES</button>
      </div>

      <button class="icon-btn" id="btnSettings" title="Settings">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"
                stroke="currentColor" stroke-width="2"/>
          <path d="M19.4 15a1 1 0 0 0 .2 1.1l.1.2a1 1 0 0 1-.2 1.4l-1.1.9a1 1 0 0 1-1.2.1l-1.1-.6a1 1 0 0 0-1.1.1l-.3.2a1 1 0 0 0-.4 1.1l.2 1.3a1 1 0 0 1-1 .9h-1.4a1 1 0 0 1-1-.9l.2-1.3a1 1 0 0 0-.4-1.1l-.3-.2a1 1 0 0 0-1.1-.1l-1.1.6a1 1 0 0 1-1.2-.1l-1.1-.9a1 1 0 0 1-.2-1.4l.1-.2a1 1 0 0 0 .2-1.1l-.1-.3a1 1 0 0 0-1-.7l-1.3-.1a1 1 0 0 1-.9-1v-1.4a1 1 0 0 1 .9-1l1.3-.1a1 1 0 0 0 1-.7l.1-.3a1 1 0 0 0-.2-1.1l-.1-.2a1 1 0 0 1 .2-1.4l1.1-.9a1 1 0 0 1 1.2-.1l1.1.6a1 1 0 0 0 1.1-.1l.3-.2a1 1 0 0 0 .4-1.1l-.2-1.3a1 1 0 0 1 1-.9h1.4a1 1 0 0 1 1 .9l-.2 1.3a1 1 0 0 0 .4 1.1l.3.2a1 1 0 0 0 1.1.1l1.1-.6a1 1 0 0 1 1.2.1l1.1.9a1 1 0 0 1 .2 1.4l-.1.2a1 1 0 0 0-.2 1.1l.1.3a1 1 0 0 0 1 .7l1.3.1a1 1 0 0 1 .9 1v1.4a1 1 0 0 1-.9 1l-1.3.1a1 1 0 0 0-1 .7l-.1.3Z"
                stroke="currentColor" stroke-width="1.4"/>
        </svg>
      </button>
    </header>

    <!-- Controls row -->
    <section class="controls">
      <div class="chip-row">
        <button id="btnReorder" class="chip" type="button">
          <i class="lock" aria-hidden="true"></i>
          <span data-i18n="reorder">Reorder</span>
        </button>
        <button id="btnHistory" class="chip" type="button">
          <span data-i18n="history">History</span>
        </button>
        <button id="btnNewRound" class="chip solid" type="button">
          <span data-i18n="newRound">New round</span>
        </button>
      </div>
    </section>

    <!-- Players -->
    <h3 class="section-title" id="playersLabel">Players</h3>
    <div id="players" class="players" aria-live="polite"></div>

    <button id="addPlayer" class="add-player" type="button">
      <span id="addPlayerLbl">+ Add player</span>
    </button>
  </div>

  <!-- ===== New round modal ===== -->
  <dialog id="roundDlg">
    <div class="modal" role="dialog" aria-labelledby="roundTitle">
      <div class="hd">
        <strong id="roundTitle">New Round</strong>
        <button class="btn ghost" id="roundClose">Close</button>
      </div>
      <p style="margin:0 0 10px;color:var(--sub)" id="roundHint">
        Enter points (negatives OK). “−10” selects exactly one player and sets that input to −10.
      </p>

      <div id="roundForm" class="grid"></div>

      <div class="footerRow">
        <button class="btn ghost" id="roundCancel">Cancel</button>
        <button class="btn primary" id="roundApply">Apply</button>
      </div>
    </div>
  </dialog>

  <!-- ===== Settings (only language passthrough) ===== -->
  <dialog id="settings">
    <div class="modal" role="dialog" aria-labelledby="sH">
      <div class="hd">
        <strong id="sH">Settings</strong>
        <button class="btn ghost" id="sClose">Close</button>
      </div>
      <p style="margin:0 0 6px;color:var(--sub)">Language</p>
      <div class="lang">
        <button id="setEN" class="active" type="button">EN</button>
        <span style="opacity:.4">|</span>
        <button id="setES" type="button">ES</button>
      </div>
      <div style="height:10px"></div>
      <button class="btn primary" id="sDone">Done</button>
    </div>
  </dialog>

  <script>
    /**********************
     * i18n
     *********************/
    const STRINGS = {
      en:{
        title:"Conga by Alanis",
        stage:"STAGE v3.5.9",
        players:"Players",
        reorder:"Reorder",
        history:"History",
        newRound:"New round",
        addPlayer:"+ Add player",
        newRoundT:"New Round",
        newRoundHint:"Enter points (negatives OK). “−10” selects exactly one player and sets that input to −10.",
        current:"Current",
        close:"Close", cancel:"Cancel", apply:"Apply",
        p:"P"
      },
      es:{
        title:"Conga por Alanis",
        stage:"ETAPA v3.5.9",
        players:"Jugadores",
        reorder:"Reordenar",
        history:"Historial",
        newRound:"Nueva ronda",
        addPlayer:"+ Agregar jugador",
        newRoundT:"Nueva ronda",
        newRoundHint:"Ingresa puntos (se permiten negativos). “−10” selecciona exactamente un jugador y fija ese valor en −10.",
        current:"Actual",
        close:"Cerrar", cancel:"Cancelar", apply:"Aplicar",
        p:"J"
      }
    };

    /**********************
     * State & storage
     *********************/
    const STORAGE_KEY = "conga_state_v2";
    const LANG_KEY = "conga_lang";
    const defaultState = () => ({
      players: [],
      nextDealer: 0
    });

    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const s = JSON.parse(raw);
        if(!Array.isArray(s.players)) s.players = [];
        return s;
      }catch(e){ return defaultState(); }
    }
    function saveState(s){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(s));
    }

    function ensureTwoPlayers(s){
      const baseNames = ["Player 1","Player 2"];
      if(currentLang()==="es") baseNames.splice(0,2,"Jugador 1","Jugador 2");
      while(s.players.length<2){
        const i = s.players.length;
        s.players.push({
          id: crypto?.randomUUID?.() || `${Date.now()}_${Math.random()}`,
          name: baseNames[i] || (currentLang()==="es" ? `Jugador ${i+1}` : `Player ${i+1}`),
          score: 0,
          avatar:null, eliminated:false
        });
      }
    }

    /**********************
     * Language helpers
     *********************/
    function currentLang(){ return localStorage.getItem(LANG_KEY) || "en"; }
    function setLang(l){ localStorage.setItem(LANG_KEY,l); render(); }

    function applyI18n(){
      const d = STRINGS[currentLang()];
      $("#appTitle").textContent = d.title;
      $("#appStage").textContent = d.stage;
      $("#playersLabel").textContent = d.players;
      $("[data-i18n='reorder']").textContent = d.reorder;
      $("[data-i18n='history']").textContent = d.history;
      $("[data-i18n='newRound']").textContent = d.newRound;
      $("#addPlayerLbl").textContent = d.addPlayer;

      // modal text
      $("#roundTitle").textContent = d.newRoundT;
      $("#roundHint").textContent = d.newRoundHint;

      // lang pill active
      $("#langEN").classList.toggle("active", currentLang()==="en");
      $("#langES").classList.toggle("active", currentLang()==="es");
      $("#setEN").classList.toggle("active", currentLang()==="en");
      $("#setES").classList.toggle("active", currentLang()==="es");
    }

    /**********************
     * Render players
     *********************/
    const playersEl = $("#players");
    let reorderUnlocked = false;

    function renderPlayers(){
      const s = loadState();
      ensureTwoPlayers(s);
      saveState(s);

      playersEl.innerHTML = "";
      s.players.forEach((p, idx)=>{
        const row = document.createElement("div");
        row.className = "row" + (idx===s.nextDealer ? " active" : "");
        row.draggable = reorderUnlocked;
        row.dataset.id = p.id;

        const body = document.createElement("div");
        body.className = "row-body";

        const handle = document.createElement("div");
        handle.className = "handle";
        handle.textContent = "≡";
        handle.title = "Drag";
        body.appendChild(handle);

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = (STRINGS[currentLang()].p) + (idx+1);
        body.appendChild(badge);

        const nm = document.createElement("div");
        nm.className = "pname";
        nm.textContent = p.name;
        body.appendChild(nm);

        const sc = document.createElement("div");
        sc.className = "score";
        sc.textContent = p.score;
        body.appendChild(sc);

        row.appendChild(body);
        playersEl.appendChild(row);

        if(reorderUnlocked){
          row.addEventListener("dragstart", onDragStart);
          row.addEventListener("dragover", onDragOver);
          row.addEventListener("dragleave", onDragLeave);
          row.addEventListener("drop", onDrop);
        }
      });
    }

    function render(){ applyI18n(); renderPlayers(); }

    /**********************
     * Drag reorder (when unlocked)
     *********************/
    let dragId = null;
    function onDragStart(e){
      dragId = e.currentTarget.dataset.id;
      e.dataTransfer.effectAllowed = "move";
    }
    function onDragOver(e){
      e.preventDefault();
      e.currentTarget.classList.add("drag-hint");
    }
    function onDragLeave(e){
      e.currentTarget.classList.remove("drag-hint");
    }
    function onDrop(e){
      e.preventDefault();
      const targetId = e.currentTarget.dataset.id;
      e.currentTarget.classList.remove("drag-hint");
      if(!dragId || dragId===targetId) return;
      const s = loadState();
      const from = s.players.findIndex(p=>p.id===dragId);
      const to = s.players.findIndex(p=>p.id===targetId);
      if(from<0||to<0) return;
      const [moved] = s.players.splice(from,1);
      s.players.splice(to,0,moved);
      saveState(s);
      renderPlayers();
    }

    /**********************
     * New round dialog
     *********************/
    const roundDlg = $("#roundDlg");
    const roundForm = $("#roundForm");
    $("#btnNewRound").addEventListener("click", openRound);
    $("#roundClose").addEventListener("click", ()=>roundDlg.close());
    $("#roundCancel").addEventListener("click", ()=>roundDlg.close());
    $("#roundApply").addEventListener("click", applyRound);

    function openRound(){
      const d = STRINGS[currentLang()];
      const s = loadState();
      ensureTwoPlayers(s);
      saveState(s);

      roundForm.innerHTML = "";
      const radioName = "minusTen";
      s.players.forEach((p, idx)=>{
        const row = document.createElement("div");
        row.className = "rowInput";

        const nm = document.createElement("div");
        nm.className = "nm";
        nm.textContent = `${p.name}  ·  ${d.current}: ${p.score}`;
        row.appendChild(nm);

        const input = document.createElement("input");
        input.type="number";
        input.inputMode="numeric";
        input.placeholder="0";
        input.dataset.pid = p.id;
        row.appendChild(input);

        const m10 = document.createElement("label");
        m10.className="minus10";
        const r = document.createElement("input");
        r.type="radio"; r.name=radioName; r.value=p.id; r.style.accentColor="#64efb2";
        const span = document.createElement("span");
        span.textContent="−10";
        m10.appendChild(r); m10.appendChild(span);
        row.appendChild(m10);

        roundForm.appendChild(row);
      });

      roundDlg.showModal();
    }

    function applyRound(){
      const s = loadState();
      const chosen = roundForm.querySelector('input[type="radio"][name="minusTen"]:checked');
      if(!chosen){
        alert(currentLang()==="es" ? "Debes elegir exactamente un −10." : "You must choose exactly one −10.");
        return;
      }
      const minusId = chosen.value;

      // collect points
      const inputs = roundForm.querySelectorAll('input[type="number"]');
      const points = {};
      inputs.forEach(inp=>{
        const id = inp.dataset.pid;
        let val = inp.value.trim()==="" ? 0 : Number(inp.value);
        if(id===minusId) val = -10;
        if(Number.isNaN(val)) val = 0;
        points[id] = Math.trunc(val);
      });

      // apply
      s.players = s.players.map(p => ({...p, score: p.score + (points[p.id] ?? 0)}));
      // advance dealer
      s.nextDealer = (s.nextDealer + 1) % s.players.length;
      saveState(s);
      roundDlg.close();
      render();
    }

    /**********************
     * Add player
     *********************/
    $("#addPlayer").addEventListener("click", ()=>{
      const s = loadState();
      ensureTwoPlayers(s);
      const idx = s.players.length + 1;
      s.players.push({
        id: crypto?.randomUUID?.() || `${Date.now()}_${Math.random()}`,
        name: currentLang()==="es" ? `Jugador ${idx}` : `Player ${idx}`,
        score: 0,
        avatar:null, eliminated:false
      });
      saveState(s);
      renderPlayers();
    });

    /**********************
     * Reorder lock/unlock
     *********************/
    $("#btnReorder").addEventListener("click", ()=>{
      reorderUnlocked = !reorderUnlocked;
      // subtle visual change: when unlocked, change border to solid highlight
      $("#btnReorder").style.borderStyle = reorderUnlocked ? "solid" : "dashed";
      renderPlayers();
    });

    /**********************
     * History/Settings (stubs)
     *********************/
    $("#btnHistory").addEventListener("click", ()=>{
      alert(currentLang()==="es" ? "Historial (pendiente)" : "History (todo)");
    });

    const settingsDlg = $("#settings");
    $("#btnSettings").addEventListener("click", ()=>settingsDlg.showModal());
    $("#sClose").addEventListener("click", ()=>settingsDlg.close());
    $("#sDone").addEventListener("click", ()=>settingsDlg.close());
    $("#setEN").addEventListener("click", ()=>setLang("en"));
    $("#setES").addEventListener("click", ()=>setLang("es"));

    /**********************
     * Header language
     *********************/
    $("#langEN").addEventListener("click", ()=>setLang("en"));
    $("#langES").addEventListener("click", ()=>setLang("es"));

    /**********************
     * Boot
     *********************/
    (function init(){
      // Make sure there are always 2 players at minimum
      const s = loadState();
      ensureTwoPlayers(s);
      saveState(s);
      render();
    })();
  </script>
</body>
</html>
